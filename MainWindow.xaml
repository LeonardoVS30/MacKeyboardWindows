<Window x:Class="MacKeyboardWindows.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Mac Keyboard for Windows"
        SizeToContent="WidthAndHeight"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        Topmost="True" Loaded="MainWindow_Loaded" MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Window.Resources>
        <!-- ANIMACIÓN DEL MENÚ HAMBURGUESA -->
        <!-- Convierte las 3 líneas en una X cuando está marcado -->
        <ControlTemplate x:Key="HamburgerMenuTemplate" TargetType="ToggleButton">
            <Border Background="Transparent" Width="30" Height="30" CornerRadius="15">
                <Grid Width="16" Height="14" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <!-- Línea Superior -->
                    <Rectangle x:Name="TopLine" Height="2" Width="16" VerticalAlignment="Top" Fill="{DynamicResource KeyForegroundColor}" RadiusX="1" RadiusY="1" RenderTransformOrigin="0.5,0.5">
                        <Rectangle.RenderTransform>
                            <TransformGroup>
                                <TranslateTransform Y="0"/>
                                <RotateTransform Angle="0"/>
                            </TransformGroup>
                        </Rectangle.RenderTransform>
                    </Rectangle>
                    <!-- Línea Central -->
                    <Rectangle x:Name="MiddleLine" Height="2" Width="16" VerticalAlignment="Center" Fill="{DynamicResource KeyForegroundColor}" RadiusX="1" RadiusY="1" Opacity="1"/>
                    <!-- Línea Inferior -->
                    <Rectangle x:Name="BottomLine" Height="2" Width="16" VerticalAlignment="Bottom" Fill="{DynamicResource KeyForegroundColor}" RadiusX="1" RadiusY="1" RenderTransformOrigin="0.5,0.5">
                        <Rectangle.RenderTransform>
                            <TransformGroup>
                                <TranslateTransform Y="0"/>
                                <RotateTransform Angle="0"/>
                            </TransformGroup>
                        </Rectangle.RenderTransform>
                    </Rectangle>
                </Grid>
            </Border>
        </ControlTemplate>
    </Window.Resources>

    <Border BorderThickness="1" CornerRadius="10" Margin="10" 
            x:Name="MainBorder" Background="{DynamicResource MainBackgroundColor}" 
            BorderBrush="{DynamicResource BorderColor}" RenderTransformOrigin="0.5,0.5">
                <RowDefinition Height="Auto"/>
                <!-- Teclado -->
            </Grid.RowDefinitions>

            <!-- FILA DE CABECERA (TÍTULO Y BOTONES) -->
            <Grid Grid.Row="0" x:Name="HeaderPanel" Height="32" Background="{DynamicResource HeaderBackgroundColor}"
                  MouseLeftButtonDown="HeaderPanel_MouseLeftButtonDown">
                <Grid.ColumnDefinitions>
                    <!-- Menú -->
                    <ColumnDefinition Width="Auto"/>
                    <!-- Espacio vacío (para arrastrar) -->
                    <ColumnDefinition Width="*"/>
                    <!-- Botones acción derecha -->
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- BOTÓN DE MENÚ HAMBURGUESA ANIMADO -->
                <ToggleButton x:Name="MenuToggleButton" Grid.Column="0" 
                              Template="{StaticResource HamburgerMenuTemplate}"
                              Click="MenuToggleButton_Click">
                    <ToggleButton.ContextMenu>
                        <ContextMenu x:Name="MainMenu" Style="{StaticResource AppContextMenuStyle}" Closed="MainMenu_Closed">
                            <MenuItem Header="Appearance">
                                <MenuItem Header="System Theme" Tag="System" Click="Theme_Click"/>
                                <Separator Style="{StaticResource AppMenuSeparatorStyle}"/>
                                <MenuItem Header="Light" Tag="Light" Click="Theme_Click"/>
                                <MenuItem Header="Dark" Tag="Dark" Click="Theme_Click"/>
                                <MenuItem Header="Liquid Glass" Tag="LiquidGlass" Click="Theme_Click"/>
                            </MenuItem>
                            <MenuItem Header="Opacity">
                                <MenuItem Header="100%" Tag="1.0" Click="Opacity_Click"/>
                                <MenuItem Header="90%" Tag="0.9" Click="Opacity_Click"/>
                                <MenuItem Header="80%" Tag="0.8" Click="Opacity_Click"/>
                                <MenuItem Header="70%" Tag="0.7" Click="Opacity_Click"/>
                            </MenuItem>
                            <MenuItem Header="Zoom">
                                <MenuItem Header="50%" Tag="0.5" Click="Zoom_Click"/>
                                <MenuItem Header="75%" Tag="0.75" Click="Zoom_Click"/>
                                <Separator Style="{StaticResource AppMenuSeparatorStyle}"/>
                                <MenuItem Header="100% (Default)" Tag="1.0" Click="Zoom_Click"/>
                                <Separator Style="{StaticResource AppMenuSeparatorStyle}"/>
                                <MenuItem Header="125%" Tag="1.25" Click="Zoom_Click"/>
                                <MenuItem Header="150%" Tag="1.5" Click="Zoom_Click"/>
                                <MenuItem Header="200%" Tag="2.0" Click="Zoom_Click"/>
                                <MenuItem Header="250%" Tag="2.5" Click="Zoom_Click"/>
                            </MenuItem>
                            <MenuItem Header="Distribución">
                                <MenuItem Header="Español" Tag="ES" Click="Layout_Click" />
                                <MenuItem Header="Americano" Tag="US" Click="Layout_Click" />
                            </MenuItem>
                            <MenuItem Header="Sonido" IsCheckable="True" IsChecked="True" Click="SoundToggle_Click"/>
                            <Separator Style="{StaticResource AppMenuSeparatorStyle}"/>
                            <MenuItem Header="Close App" Click="CloseMenuItem_Click"/>
                        </ContextMenu>
                    </ToggleButton.ContextMenu>
                </ToggleButton>

                <!-- Botones a la derecha -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">

                    <!-- Botón Minimizar -->
                    <Border Style="{StaticResource NeumorphicHeaderButtonStyle}" 
                            ToolTip="Minimizar" 
                            MouseLeftButtonDown="MinimizeButton_Click">
                        <Path Data="{StaticResource IconWindowMinimize}" 
                              Style="{StaticResource NeumorphicHeaderIconStyle}"
                              Width="8" Height="2"/>
                    </Border>

                    <!-- Botón Cerrar -->
                    <Border Style="{StaticResource NeumorphicHeaderButtonStyle}" 
                            ToolTip="Cerrar" 
                            MouseLeftButtonDown="CloseButton_Click">
                        <Path Data="{StaticResource IconWindowClose}" 
                              Style="{StaticResource NeumorphicHeaderIconStyle}"
                              Width="8" Height="8"/>
                    </Border>

                </StackPanel>
            </Grid>

            <!-- CONTENEDOR DINÁMICO PARA EL TECLADO -->
            <Grid x:Name="KeyboardContainer" Grid.Row="1" Margin="5,0,5,10" />

            <!-- TRANSITION OVERLAY -->
            <Grid x:Name="TransitionOverlay" Grid.RowSpan="2" Visibility="Collapsed" IsHitTestVisible="False">
                <Image x:Name="TransitionImage" Stretch="Fill" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                <Border x:Name="TransitionGlassWave" HorizontalAlignment="Left" Width="60" Opacity="0.8" VerticalAlignment="Stretch">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                            <GradientStop Color="#00FFFFFF" Offset="0"/>
                            <GradientStop Color="#60FFFFFF" Offset="0.5"/>
                            <GradientStop Color="#00FFFFFF" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Border.Effect>
                        <BlurEffect Radius="20"/>
                    </Border.Effect>
                    <Border.RenderTransform>
                        <TranslateTransform x:Name="GlassWaveTranslate" X="-100"/>
                    </Border.RenderTransform>
                </Border>
            </Grid>

        </Grid>
    </Border>
</Window>