<Window x:Class="MacKeyboardWindows.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Mac Keyboard for Windows"
        SizeToContent="WidthAndHeight"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        Loaded="MainWindow_Loaded"
        MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Window.Resources>
        <!-- ANIMACIÓN DEL MENÚ HAMBURGUESA -->
        <ControlTemplate x:Key="HamburgerMenuTemplate" TargetType="ToggleButton">
            <Border Background="Transparent" Width="30" Height="30" CornerRadius="15">
                <Grid Width="16" Height="14" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <Rectangle x:Name="TopLine" Height="2" Width="16" VerticalAlignment="Top" Fill="{DynamicResource KeyForegroundColor}" RadiusX="1" RadiusY="1" RenderTransformOrigin="0.5,0.5">
                        <Rectangle.RenderTransform>
                            <RotateTransform Angle="0"/>
                        </Rectangle.RenderTransform>
                    </Rectangle>
                    <Rectangle x:Name="MiddleLine" Height="2" Width="16" VerticalAlignment="Center" Fill="{DynamicResource KeyForegroundColor}" RadiusX="1" RadiusY="1" Opacity="1"/>
                    <Rectangle x:Name="BottomLine" Height="2" Width="16" VerticalAlignment="Bottom" Fill="{DynamicResource KeyForegroundColor}" RadiusX="1" RadiusY="1" RenderTransformOrigin="0.5,0.5">
                        <Rectangle.RenderTransform>
                            <RotateTransform Angle="0"/>
                        </Rectangle.RenderTransform>
                    </Rectangle>
                </Grid>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsChecked" Value="True">
                    <Setter TargetName="TopLine" Property="RenderTransform">
                        <Setter.Value>
                            <TransformGroup>
                                <TranslateTransform Y="6"/>
                                <RotateTransform Angle="45"/>
                            </TransformGroup>
                        </Setter.Value>
                    </Setter>
                    <Setter TargetName="MiddleLine" Property="Opacity" Value="0"/>
                    <Setter TargetName="BottomLine" Property="RenderTransform">
                        <Setter.Value>
                            <TransformGroup>
                                <TranslateTransform Y="-6"/>
                                <RotateTransform Angle="-45"/>
                            </TransformGroup>
                        </Setter.Value>
                    </Setter>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Cursor" Value="Hand"/>
                    <Setter Property="Opacity" Value="0.8"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
    </Window.Resources>

    <!-- CONTENEDOR PRINCIPAL CON LA TRANSFORMACIÓN DE ESCALA -->
    <Grid>
        <Border Name="MainBorder" Width="1100" MinHeight="350" 
                Background="{DynamicResource WindowBackgroundColor}" 
                CornerRadius="12" 
                BorderBrush="{DynamicResource WindowBorderColor}" 
                BorderThickness="1">

            <!-- AQUÍ ESTÁ EL SCALE TRANSFORM QUE BUSCA EL CÓDIGO C# -->
            <Border.LayoutTransform>
                <ScaleTransform x:Name="WindowScaleTransform" ScaleX="1.0" ScaleY="1.0" />
            </Border.LayoutTransform>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Barra de título -->
                <Grid Grid.Row="0" Margin="10,8,10,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Menú Hamburguesa -->
                    <ToggleButton x:Name="MenuToggleButton" Grid.Column="0" Template="{StaticResource HamburgerMenuTemplate}" Click="MenuToggleButton_Click">
                        <ToggleButton.ContextMenu>
                            <ContextMenu x:Name="MainMenu" Style="{StaticResource AppContextMenuStyle}" Closed="MainMenu_Closed">
                                <MenuItem Header="Appearance">
                                    <MenuItem Header="System Theme" Tag="System" Click="Theme_Click"/>
                                    <Separator Style="{StaticResource AppMenuSeparatorStyle}"/>
                                    <MenuItem Header="Light" Tag="Light" Click="Theme_Click"/>
                                    <MenuItem Header="Dark" Tag="Dark" Click="Theme_Click"/>
                                    <MenuItem Header="Liquid Glass" Tag="LiquidGlass" Click="Theme_Click"/>
                                </MenuItem>
                                <MenuItem Header="Opacity">
                                    <MenuItem Header="100%" Tag="1.0" Click="Opacity_Click"/>
                                    <MenuItem Header="90%" Tag="0.9" Click="Opacity_Click"/>
                                    <MenuItem Header="80%" Tag="0.8" Click="Opacity_Click"/>
                                    <MenuItem Header="70%" Tag="0.7" Click="Opacity_Click"/>
                                </MenuItem>
                                <MenuItem Header="Zoom">
                                    <MenuItem Header="50%" Tag="0.5" Click="Zoom_Click"/>
                                    <MenuItem Header="75%" Tag="0.75" Click="Zoom_Click"/>
                                    <Separator Style="{StaticResource AppMenuSeparatorStyle}"/>
                                    <MenuItem Header="100% (Default)" Tag="1.0" Click="Zoom_Click"/>
                                    <Separator Style="{StaticResource AppMenuSeparatorStyle}"/>
                                    <MenuItem Header="125%" Tag="1.25" Click="Zoom_Click"/>
                                    <MenuItem Header="150%" Tag="1.5" Click="Zoom_Click"/>
                                    <MenuItem Header="200%" Tag="2.0" Click="Zoom_Click"/>
                                    <MenuItem Header="250%" Tag="2.5" Click="Zoom_Click"/>
                                </MenuItem>
                                <MenuItem Header="Distribución">
                                    <MenuItem Header="Español" Tag="ES" Click="Layout_Click" />
                                    <MenuItem Header="Americano" Tag="US" Click="Layout_Click" />
                                </MenuItem>
                                <MenuItem Header="Sonido" IsCheckable="True" IsChecked="True" Click="SoundToggle_Click"/>
                                <Separator Style="{StaticResource AppMenuSeparatorStyle}"/>
                                <MenuItem Header="Close App" Click="CloseMenuItem_Click"/>
                            </ContextMenu>
                        </ToggleButton.ContextMenu>
                    </ToggleButton>

                    <!-- Botones Neumórficos -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                        <Border Style="{StaticResource NeumorphicHeaderButtonStyle}" ToolTip="Minimizar" MouseLeftButtonDown="MinimizeButton_Click">
                            <Path Data="{StaticResource IconWindowMinimize}" Style="{StaticResource NeumorphicHeaderIconStyle}" Width="8" Height="2"/>
                        </Border>
                        <Border Style="{StaticResource NeumorphicHeaderButtonStyle}" ToolTip="Cerrar" MouseLeftButtonDown="CloseButton_Click">
                            <Path Data="{StaticResource IconWindowClose}" Style="{StaticResource NeumorphicHeaderIconStyle}" Width="8" Height="8"/>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- Contenedor del Teclado -->
                <Grid x:Name="KeyboardContainer" Grid.Row="1" Margin="5,0,5,10" />
            </Grid>
        </Border>

        <!-- CAPA DE TRANSICIÓN PARA LA ANIMACIÓN DE TEMA -->
        <!-- Se superpone al borde principal para mostrar el tema antiguo mientras se anima -->
        <Grid x:Name="TransitionOverlay" Visibility="Collapsed" IsHitTestVisible="False">
            <Grid.LayoutTransform>
                <!-- Aplicamos la misma escala para que coincida exactamente -->
                <ScaleTransform ScaleX="{Binding ElementName=WindowScaleTransform, Path=ScaleX}" 
                                 ScaleY="{Binding ElementName=WindowScaleTransform, Path=ScaleY}"/>
            </Grid.LayoutTransform>

            <!-- Imagen del tema antiguo -->
            <Image x:Name="TransitionImage" Stretch="None" HorizontalAlignment="Left" VerticalAlignment="Top"/>

            <!-- Onda de cristal que barre la pantalla -->
            <Border x:Name="TransitionGlassWave" Width="50" HorizontalAlignment="Left" VerticalAlignment="Stretch" Background="#40FFFFFF">
                <Border.Effect>
                    <BlurEffect Radius="20"/>
                </Border.Effect>
                <Border.RenderTransform>
                    <TranslateTransform x:Name="GlassWaveTranslate" X="-100"/>
                </Border.RenderTransform>
            </Border>
        </Grid>
    </Grid>
</Window>